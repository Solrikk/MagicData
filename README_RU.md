<div align="center">
  <img src="https://github.com/Solrikk/MagicXML/blob/main/assets/gif/taxi-data-science-graphs-on-pc-screen.gif" width="30%"/>
</div>


<div align="center"> <h3> <a href="https://github.com/Solrikk/MagicXML/blob/main/README.md">Английский</a> | <a href="https://github.com/Solrikk/MagicXML/blob/main/README_RU.md">⭐Русский⭐</a> | <a href="https://github.com/Solrikk/MagicXML/blob/main/README_GE.md">Немецкий</a> | <a href="https://github.com/Solrikk/MagicXML/blob/main/README_JP.md">Японский</a> | <a href="README_KR.md">Корейский</a> | <a href="README_CN.md">Китайский</a> </h3> </div>

-----------------

# Magic-XML ✨

**_Magic-XML доступен на https://xmlmagic.ru_**

**_Magic-XML_** — это современное веб-приложение, разработанное для удобного и быстрого преобразования данных из XML файлов в формат CSV. Приложение использует мощность FastAPI для обеспечения высокой производительности при обработке запросов, а также применяет алгоритмы машинного обучения и обработку естественного языка для эффективного анализа и классификации текстовой информации. Magic-XML идеально подходит для аналитиков данных, разработчиков и всех, кто работает с большим объемом XML данных и стремится к их оптимизации и упрощению анализа.

**_Зависимости:_** ⚙️
- `fastapi` - Фреймворк для создания API с автоматической документацией.
- `uvicorn` - ASGI сервер для запуска приложений FastAPI.
- `requests` - Библиотека для выполнения HTTP запросов.
- `xml.etree.ElementTree` - Модуль для обработки XML.
- `csv` - Модуль для работы с CSV файлами.
- `os` - Модуль для взаимодействия с операционной системой, используется для создания директорий.
- `Jinja2Templates` из FastAPI для работы с шаблонами Jinja2.
- `StaticFiles` - Для предоставления статических файлов.
- `BaseModel` из `pydantic` - Для валидации данных.
- `FileResponse` для отправки файлов в ответах.
- `spacy` - Для обработки естественного языка, используется для категоризации.
- `TfidfVectorizer` для векторизации текста.
- `cosine_similarity` для расчета косинусного сходства.
- `re` - Модуль для работы с регулярными выражениями.

**Структура приложения:**
- `Приложение FastAPI`: Инициализирует главное приложение с FastAPI, настраивает маршруты для статических файлов и `движок шаблонов Jinja2`.
- `Класс LinkData (модель Pydantic)`: Модель для валидации входящих данных, получаемых через `POST-запрос на /process_link`.

**Функции обработки данных:**
- `Get_category_replacement()`: Функция для категоризации на основе косинусного сходства между векторами.
- `Load_custom_categories()`: Загрузка пользовательских категорий из CSV файла.
- `Remove_unwanted_tags()`: Очистка описаний продуктов от HTML тегов.
- `Process_link()`: Главная функция для обработки XML ссылки, извлечения и сохранения данных в CSV файл.

**Маршруты FastAPI:**
- `GET /`: Отображение главной страницы через шаблон Jinja2.
- `POST /process_link`: Принимает данные для обработки ссылки и генерирует CSV файл.
- `GET /download/data_files/{filename}`: Возможность скачивания сгенерированных CSV файлов.

## _Адаптация категорий с использованием TF-IDF и косинусного сходства:_
Программа использует `TfidfVectorizer` и `косинусное сходство` для определения наиболее подходящей пользовательской категории для продукта на основе его исходного названия категории, полученного из XML. Это демонстрирует интересный подход к задаче классификации или `маппинга категорий`, где вместо прямого сопоставления используются `методы машинного обучения`, чтобы повысить точность и гибкость процесса.

<img src="https://github.com/Solrikk/MagicXML/blob/main/assets/TF-IDF%20Visualization/TF-IDF%20Visualization.png" width="95%" /> 

more info[[created](https://github.com/Solrikk/MagicXML/tree/main/assets/TF-IDF%20Visualization)]

**Косинусное сходство** — это метрика, используемая для определения степени сходства между двумя сущностями вне зависимости от их размера. Математически оно измеряет косинус угла между двумя векторами, проецированными в многомерное пространство. Этот концепт берёт начало из области линейной алгебры и может применяться в различных контекстах, таких как анализ данных, обработка естественного языка (NLP) и системы поиска информации.

> Суть `косинусного сходства` довольно проста. Представьте, что у вас есть два вектора (массивы чисел), каждый из которых представляет характеристики сущности в многомерном пространстве. "Угол" между этими векторами даёт представление о их сходстве. Если угол равен 0 градусов, это значит, что векторы идеально выровнены, что указывает на коэффициент сходства 1 — максимальное сходство. Наоборот, если угол равен 90 градусам, косинусное сходство равно 0, указывая на отсутствие сходства. Углы между 0 и 90 градусами дают коэффициент сходства где-то между 0 и 1, при этом меньший угол даёт более высокий коэффициент.

![Визуализация косинусного сходства](https://github.com/Solrikk/MagicXML/blob/main/assets/Visualization%20Cosine%20Similarity%20Matrix/Visualization%20Cosine%20Similarity%20Matrix.png)

подробнее[[создано](https://github.com/Solrikk/MagicXML/tree/main/assets/Visualization%20Cosine%20Similarity%20Matrix)]

- TF (**частота термина**) — это отношение количества вхождений определённого слова к общему количеству слов в документе.

![Частота термина](https://wikimedia.org/api/rest_v1/media/math/render/svg/8ef207eb03f6e9b6f71e73739f45b5179b4f17cc)

- IDF (**обратная документная частота**) — инверсия частоты, с которой определённое слово появляется в документах коллекции. Основатель этого концепта — Карен Сперк Джонс. Учёт IDF уменьшает вес широко используемых слов. Для каждого уникального слова в специфической коллекции документов существует только одно значение IDF.

![Обратная документная частота](https://wikimedia.org/api/rest_v1/media/math/render/svg/b88834044365dea6aedba224eabe7147d4d328ef)

```python
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

def get_category_replacement(original_category_name, custom_categories):
    vectorizer = TfidfVectorizer()
    all_categories = [original_category_name] + custom_categories
    tfidf_matrix = vectorizer.fit_transform(all_categories)
    cosine_similarities = cosine_similarity(tfidf_matrix[0:1], tfidf_matrix[1:]).flatten()
    return custom_categories[cosine_similarities.argmax()]
```

1. **Векторизация категорий:**
Используя TF-IDF, программа преобразует названия категорий (одно из оригинальных названий и список пользовательских категорий) в векторное представление. Это означает, что каждая категория становится вектором в многомерном пространстве, где каждое измерение представляет слово из корпуса категории, а значение отражает важность слова в контексте категории.
2. **Нахождение косинусного сходства:**
Затем программа вычисляет косинусное сходство между вектором оригинальной категории и векторами каждой пользовательской категории. Это сравнивает, насколько близки пользовательские категории к оригинальной категории в терминах контекстуального сходства.
3. **Выбор наиболее подходящей категории:**
После вычисления косинусных сходств выбирается пользовательская категория с наивысшим значением сходства по отношению к оригинальной категории. Это означает, что данная категория считается наиболее подходящей или близкой к оригинальной категории с точки зрения семантического содержания.

> Этот концепт особенно полезен при анализе текстов для сравнения документов или текстов. Преобразуя тексты в векторы (с использованием таких техник, как TF-IDF), где каждое измерение представляет конкретное слово и значение в этом измерении отражает значимость слова, мы можем сравнить эти векторы, чтобы выяснить, насколько похожи тексты друг на друга. Это часто используется в поисковых системах, системах проверки на плагиат и рекомендательных системах для поиска или предложения контента, который наиболее похож на данный ввод.

## _Асинхронная обработка запросов:_
FastAPI построен на основе Starlette и позволяет обрабатывать запросы асинхронно с использованием ключевых слов async и await. Это позволяет приложению масштабироваться и эффективно обслуживать большое количество запросов, улучшая производительность при операциях ввода/вывода, таких как запросы к внешним API или операции чтения файлов. В приложении асинхронная обработка может быть особенно полезной в сценариях, подобных загрузке файлов через конечную точку `/download/data_files/{filename}`, где асинхронное чтение файлов может значительно сократить время ожидания для клиента.

## _Обработка конечных точек с асинхронными функциями:_

- В коде определена асинхронная конечная точка process_link_post через декоратор `@app.post("/process_link")`. Эта конечная точка асинхронно обрабатывает `POST-запросы`, отправляя данные ссылки (например, URL для обработки). Использование ключевого слова async перед определением функции указывает, что функция будет выполняться асинхронно.
- Аналогично, асинхронный метод download_csv обрабатывает `GET-запросы` на скачивание файлов. Это также позволяет обрабатывать запросы на скачивание файлов без блокировки основного исполнительного потока приложения.

## _Работа с текстом и обработка естественного языка_
> Использование spaCy и TfidfVectorizer из scikit-learn для категоризации текстов демонстрирует, как инструменты машинного обучения могут быть эффективно применены в веб-приложениях. spaCy используется для предварительной обработки текста на русском языке, что важно для точной работы категоризации, поскольку обработка текста включает в себя множество аспектов, таких как лемматизация и удаление стоп-слов, которые значительно влияют на конечную точность. TfidfVectorizer преобразует текст в векторное представление, позволяя затем вычислить косинусное сходство между векторами, что используется для выбора наиболее подходящей категории для текста.

![Визуализация зависимостей в SpaCy](https://github.com/Solrikk/MagicXML/blob/main/assets/SpaCy%20Dependency%20Visualization/SpaCy%20Dependency%20Visualization.jpeg)

## _Обработка XML и генерация CSV_
Приложение включает в себя разбор XML-файлов для извлечения данных о продуктах, демонстрируя возможность работы с различными форматами данных. После извлечения и классификации данных они сохраняются в формате CSV, который является широко принятым стандартом для обмена табличными данными и может быть легко импортирован в различные системы и приложения для дальнейшего анализа.

## _Техническая реализация веб-интерфейса_
Приложение использует Jinja2Templates для генерации динамического HTML-контента. Это позволяет создать более интерактивный и ориентированный на пользователя интерфейс. Вместе с обслуживанием статических файлов через StaticFiles это создает полноценный веб-интерфейс для взаимодействия с приложением, устраняя необходимость для пользователя работать напрямую с API или командной строкой.

## _Валидация данных с помощью Pydantic_
Использование моделей Pydantic для валидации входящих данных не только обеспечивает правильность данных, но и позволяет автоматически генерировать документацию API. Это значительно упрощает как разработку, так и использование API, поскольку клиенты могут точно знать, какие данные и в каком формате ожидаются на входе.

## _Обработка ошибок и исключений_
Приложение включает обработку исключений, таких как ошибка доступа к URL или ошибка чтения файла. Это обеспечивает стабильность работы приложения и предоставляет пользователю информативную обратную связь о проблеме через механизмы исключений HTTP в FastAPI.

## _Клонирование репозитория: Клонируйте код приложения на свою машину._
- Установка зависимостей: Установите необходимые зависимости, используя `pip install -r requirements.txt.`
- Запуск сервера: Запустите приложение с помощью команды `uvicorn main:app --reload.`

**Использование:**
- Для обработки XML-файлов используйте веб-интерфейс или отправьте запрос на `/process_link` с URL вашего XML-файла. Полученный CSV-файл будет доступен для скачивания по предоставленной ссылке.

### Обрабатывайте свои данные просто и эффективно с Magic-XML!
